<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Trace"
      internalLogFile="internalLog.txt"
	  >
	<extensions>
		<add assembly="NLog.Extended" />
	</extensions>


	<targets>
		<target xsi:type="Database"
      name="dbTarget"
	  connectionString="${var:DecryptedConnectionString}"




    var builder = WebApplication.CreateBuilder(args);
    var configuration = new ConfigurationBuilder()
               .AddJsonFile("appsettings.json")
               .Build();
    var hMACDelegatingHandler = new HMACDelegatingHandler(configuration);

    // Decrypt the connection string
    string decryptedConnectionString = hMACDelegatingHandler.decryptString(configuration.GetConnectionString("DefaultConnection"));

    // Set the decrypted connection string as a variable in NLog
    LogManager.Configuration.Variables["DecryptedConnectionString"] = decryptedConnectionString;
