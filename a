public ActionResult AzureADLogin()  
{
  
  string clientId = WebConfigurationManager.AppSettings["ida:ClientId"];
  string clientSecret = WebConfigurationManager.AppSettings["ida:ClientSecret"]; 

  var authContext = new AuthenticationContext(authority);

  var credential = new ClientCredential(clientId, clientSecret);

  var result = authContext.AcquireTokenAsync(resource, credential).Result;

  if (result == null)  
  {
    throw new InvalidOperationException("Failed to obtain the JWT token");
  }
            
  // Add claims based on token

  // Sign in user             

  return RedirectToAction("Index");
}

public ActionResult LogOff()
{

  // Existing CSRF check
  Uri myReferrer = Request.UrlReferrer;
  string Referer = Convert.ToString(myReferrer);

  if (Referer == null || Referer.ToLower().IndexOf("adusermanager") < 0)
  {
    // Existing session clear
    System.Web.HttpContext.Current.Session.Clear();
    Session.Abandon();
    FormsAuthentication.SignOut();
  }
  else
  {
    // Existing session clear 
    System.Web.HttpContext.Current.Session.Clear();
    Session.Abandon();
    FormsAuthentication.SignOut();

    // Sign out from Azure AD
    string clientId = WebConfigurationManager.AppSettings["ida:ClientId"];
    string clientSecret = WebConfigurationManager.AppSettings["ida:ClientSecret"];

    string tenantId = WebConfigurationManager.AppSettings["ida:TenantId"];

    var authContext = new AuthenticationContext(authority);

    var credential = new ClientCredential(clientId, clientSecret);

    authContext.AcquireTokenAsync(resource, credential).Wait();
  }

  return RedirectToAction("Login", "Account");
}
